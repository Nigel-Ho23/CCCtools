---
title: "Create demo data"
output: html_document
date: "2025-08-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Download the raw data

We will use the same dataset used in the CellChat tutorial. 
The data is described [here]https://doi.org/10.6084/m9.figshare.13520015.v1).


```{r}
pacman::p_load(tidyverse, janitor, Seurat)

load( url("https://figshare.com/ndownloader/files/25950872"), verbose = TRUE )

names(data_humanSkin)
```

The metadata shows that there are 4 patients with non-lesional and 4 patients with lesional samples.

```{r}
dim(data_humanSkin$meta)

head(data_humanSkin$meta)

data_humanSkin$meta %>% 
  count(patient.id, condition) %>% 
  arrange(condition, desc(n))

data_humanSkin$meta %>% 
  tabyl(labels, condition)
```

The expression data is normalized counts and consists of 17,328 genes and 7,563 cells.

```{r}
dim(data_humanSkin$data)

data_humanSkin$data[1:5, 1:3]
```

# Convert to Seurat object

As most single-cell data is analyzed using Seurat, we built our functions (i.e. run_cellchat, run_cellphonedb) to use Seurat data as input. We use the `CreateSeuratObject()` function by the `Seurat` package to convert our data to a Seurat object. In most cases, this step is skipped for most users who already have a working Seurat object.

```{r}
seu <- CreateSeuratObject(
  counts    = data_humanSkin$data, 
  meta.data = data_humanSkin$meta,
  min.cells    = 75,       # genes expressed in at least 1% of the samples
  min.features = 200
  )

# Set data matrix to data layer correctly
seu[["RNA"]]$data <- seu[["RNA"]]$counts 
seu[["RNA"]]$counts <-  NULL

# Cell composition after QC
seu@meta.data %>% tabyl(labels, condition)
```

Let us subset to just the non-lesional samples:

```{r}
seu.NL <- subset(seu, condition == "NL")

usethis::use_data(seu.NL)
```

